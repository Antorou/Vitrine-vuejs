{
  "version": 3,
  "sources": ["../../@pinia/testing/dist/index.mjs"],
  "sourcesContent": ["import { createApp, isRef, isReactive, isVue2, set, toRaw, customRef } from 'vue-demi';\nimport { createPinia, setActivePinia } from 'pinia';\n\nfunction createTestingPinia({\n  initialState = {},\n  plugins = [],\n  stubActions = true,\n  stubPatch = false,\n  fakeApp = false,\n  createSpy: _createSpy\n} = {}) {\n  const pinia = createPinia();\n  pinia._p.push(({ store }) => {\n    if (initialState[store.$id]) {\n      mergeReactiveObjects(store.$state, initialState[store.$id]);\n    }\n  });\n  plugins.forEach((plugin) => pinia._p.push(plugin));\n  pinia._p.push(WritableComputed);\n  const createSpy = _createSpy || typeof jest !== \"undefined\" && jest.fn || typeof vi !== \"undefined\" && vi.fn;\n  if (!createSpy) {\n    throw new Error(\"[@pinia/testing]: You must configure the `createSpy` option.\");\n  }\n  pinia._p.push(({ store, options }) => {\n    Object.keys(options.actions).forEach((action) => {\n      store[action] = stubActions ? createSpy() : createSpy(store[action]);\n    });\n    store.$patch = stubPatch ? createSpy() : createSpy(store.$patch);\n  });\n  if (fakeApp) {\n    const app = createApp({});\n    app.use(pinia);\n  }\n  pinia._testing = true;\n  setActivePinia(pinia);\n  Object.defineProperty(pinia, \"app\", {\n    configurable: true,\n    enumerable: true,\n    get() {\n      return this._a;\n    }\n  });\n  return pinia;\n}\nfunction mergeReactiveObjects(target, patchToApply) {\n  for (const key in patchToApply) {\n    if (!patchToApply.hasOwnProperty(key))\n      continue;\n    const subPatch = patchToApply[key];\n    const targetValue = target[key];\n    if (isPlainObject(targetValue) && isPlainObject(subPatch) && target.hasOwnProperty(key) && !isRef(subPatch) && !isReactive(subPatch)) {\n      target[key] = mergeReactiveObjects(targetValue, subPatch);\n    } else {\n      if (isVue2) {\n        set(target, key, subPatch);\n      } else {\n        target[key] = subPatch;\n      }\n    }\n  }\n  return target;\n}\nfunction isPlainObject(o) {\n  return o && typeof o === \"object\" && Object.prototype.toString.call(o) === \"[object Object]\" && typeof o.toJSON !== \"function\";\n}\nfunction isComputed(v) {\n  return !!v && isRef(v) && \"effect\" in v;\n}\nfunction WritableComputed({ store }) {\n  const rawStore = toRaw(store);\n  for (const key in rawStore) {\n    const value = rawStore[key];\n    if (isComputed(value)) {\n      rawStore[key] = customRef((track, trigger) => {\n        let internalValue;\n        return {\n          get: () => {\n            track();\n            return internalValue !== void 0 ? internalValue : value.value;\n          },\n          set: (newValue) => {\n            internalValue = newValue;\n            trigger();\n          }\n        };\n      });\n    }\n  }\n}\n\nexport { createTestingPinia };\n"],
  "mappings": ";;;;;;;;;;;;;;;;AAGA,SAAS,mBAAmB;AAAA,EAC1B,eAAe,CAAC;AAAA,EAChB,UAAU,CAAC;AAAA,EACX,cAAc;AAAA,EACd,YAAY;AAAA,EACZ,UAAU;AAAA,EACV,WAAW;AACb,IAAI,CAAC,GAAG;AACN,QAAM,QAAQ,YAAY;AAC1B,QAAM,GAAG,KAAK,CAAC,EAAE,MAAM,MAAM;AAC3B,QAAI,aAAa,MAAM,MAAM;AAC3B,2BAAqB,MAAM,QAAQ,aAAa,MAAM,IAAI;AAAA,IAC5D;AAAA,EACF,CAAC;AACD,UAAQ,QAAQ,CAAC,WAAW,MAAM,GAAG,KAAK,MAAM,CAAC;AACjD,QAAM,GAAG,KAAK,gBAAgB;AAC9B,QAAM,YAAY,cAAc,OAAO,SAAS,eAAe,KAAK,MAAM,OAAO,OAAO,eAAe,GAAG;AAC1G,MAAI,CAAC,WAAW;AACd,UAAM,IAAI,MAAM,8DAA8D;AAAA,EAChF;AACA,QAAM,GAAG,KAAK,CAAC,EAAE,OAAO,QAAQ,MAAM;AACpC,WAAO,KAAK,QAAQ,OAAO,EAAE,QAAQ,CAAC,WAAW;AAC/C,YAAM,UAAU,cAAc,UAAU,IAAI,UAAU,MAAM,OAAO;AAAA,IACrE,CAAC;AACD,UAAM,SAAS,YAAY,UAAU,IAAI,UAAU,MAAM,MAAM;AAAA,EACjE,CAAC;AACD,MAAI,SAAS;AACX,UAAM,MAAM,UAAU,CAAC,CAAC;AACxB,QAAI,IAAI,KAAK;AAAA,EACf;AACA,QAAM,WAAW;AACjB,iBAAe,KAAK;AACpB,SAAO,eAAe,OAAO,OAAO;AAAA,IAClC,cAAc;AAAA,IACd,YAAY;AAAA,IACZ,MAAM;AACJ,aAAO,KAAK;AAAA,IACd;AAAA,EACF,CAAC;AACD,SAAO;AACT;AACA,SAAS,qBAAqB,QAAQ,cAAc;AAClD,aAAW,OAAO,cAAc;AAC9B,QAAI,CAAC,aAAa,eAAe,GAAG;AAClC;AACF,UAAM,WAAW,aAAa;AAC9B,UAAM,cAAc,OAAO;AAC3B,QAAI,cAAc,WAAW,KAAK,cAAc,QAAQ,KAAK,OAAO,eAAe,GAAG,KAAK,CAAC,MAAM,QAAQ,KAAK,CAAC,WAAW,QAAQ,GAAG;AACpI,aAAO,OAAO,qBAAqB,aAAa,QAAQ;AAAA,IAC1D,OAAO;AACL,UAAI,QAAQ;AACV,YAAI,QAAQ,KAAK,QAAQ;AAAA,MAC3B,OAAO;AACL,eAAO,OAAO;AAAA,MAChB;AAAA,IACF;AAAA,EACF;AACA,SAAO;AACT;AACA,SAAS,cAAc,GAAG;AACxB,SAAO,KAAK,OAAO,MAAM,YAAY,OAAO,UAAU,SAAS,KAAK,CAAC,MAAM,qBAAqB,OAAO,EAAE,WAAW;AACtH;AACA,SAAS,WAAW,GAAG;AACrB,SAAO,CAAC,CAAC,KAAK,MAAM,CAAC,KAAK,YAAY;AACxC;AACA,SAAS,iBAAiB,EAAE,MAAM,GAAG;AACnC,QAAM,WAAW,MAAM,KAAK;AAC5B,aAAW,OAAO,UAAU;AAC1B,UAAM,QAAQ,SAAS;AACvB,QAAI,WAAW,KAAK,GAAG;AACrB,eAAS,OAAO,UAAU,CAAC,OAAO,YAAY;AAC5C,YAAI;AACJ,eAAO;AAAA,UACL,KAAK,MAAM;AACT,kBAAM;AACN,mBAAO,kBAAkB,SAAS,gBAAgB,MAAM;AAAA,UAC1D;AAAA,UACA,KAAK,CAAC,aAAa;AACjB,4BAAgB;AAChB,oBAAQ;AAAA,UACV;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": []
}
